<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Schedule Settings</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/ui.css">
</head>
<body>
  <header style="background:#222;padding:1rem;display:flex;align-items:center;justify-content:space-between;">
    <h1 style="margin:0;font-size:1.4rem;">Schedule Settings</h1>
    <a href="/index.html" title="Back to main page" style="color:#fff;font-size:1.1rem;text-decoration:none;padding:.4rem .8rem;border:1px solid #444;border-radius:4px;display:inline-flex;align-items:center;gap:.4rem;">
      <span style="font-size:1.2rem;">üè†</span><span style="font-size:.75rem;letter-spacing:.5px;">Home</span>
    </a>
  </header>
  <main style="max-width:760px;margin:0 auto;padding:1rem;">
    <section>
      <div id="userSettingsPanel" class="schedule-settings" style="margin-top:1rem;">
        <h3 style="margin-top:0;font-size:1.1rem;">Schedule settings (per user)</h3>
        <div class="settings-row">
          <label for="comfortHours">Comfort hours:</label>
          <input id="comfortHours" type="number" min="1" max="12" value="3" title="Number of hours per day for comfort (hot water). Default: 3">
          <span class="tooltip">How many hours per day should be set to comfort mode (hot water)?</span>
        </div>
        <div class="settings-row">
          <label for="turnOffPercentile">Turn-off percentile:</label>
          <input id="turnOffPercentile" type="number" min="0.5" max="0.99" step="0.01" value="0.9" title="Percentile for turn-off selection. Default: 0.9">
          <span class="tooltip">Above this price percentile, hours are considered for turn-off. (0.9 = top 10% most expensive hours)</span>
        </div>
        <div class="settings-row">
          <label for="turnOffMaxConsecutive">Max consecutive turn-off hours:</label>
          <input id="turnOffMaxConsecutive" type="number" min="1" max="6" value="2" title="Maximum consecutive turn-off hours. Default: 2">
          <span class="tooltip">Maximum number of hours in a row that can be turned off. Default: 2</span>
        </div>
        <div style="display:flex;gap:.75rem;align-items:center;margin-top:.75rem;flex-wrap:wrap;">
          <button id="saveUserSettings">Save settings</button>
          <button id="revokeTokenBtn" type="button" style="background:#b23b3b;">Revoke Daikin Token</button>
          <span id="userSettingsStatus" class="error"></span>
        </div>
      </div>
    </section>
  </main>
  <script src="/ui.js"></script>
  <script>
  // Add revoke token handler (page-specific enhancement)
  const revokeBtn = document.getElementById('revokeTokenBtn');
  const statusEl = document.getElementById('userSettingsStatus');
  if(revokeBtn){
    revokeBtn.onclick = async () => {
      if(!confirm('Revoke Daikin token? This will delete current authorization.')) return;
      statusEl.textContent = 'Revoking...';
      try {
        const r = await fetch('/auth/daikin/revoke', { method:'POST' });
        if(!r.ok) throw new Error(await r.text());
        statusEl.textContent = 'Revoked. You will need to authorize again.';
      } catch(e){ statusEl.textContent = 'Error: ' + e.message; }
    };
  }
  </script>
</body>
</html>
